<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¤‘ì‹¬ê·¹í•œì •ë¦¬( CLT ) ì‹œë®¬ë ˆì´í„°</title>

  <!-- ì—ì…‹: í°íŠ¸/ìŠ¤íƒ€ì¼ (ìƒëŒ€ê²½ë¡œëŠ” í˜ì´ì§€ ê¹Šì´ì— ë§ê²Œ ì¡°ì •) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/style.css" />

  <!-- favicon 404 ë°©ì§€ -->
  <link rel="icon" href="data:," />

  <style>
    /* ===== ì´ í˜ì´ì§€ ì „ìš© ìµœì†Œ ìŠ¤íƒ€ì¼ (ê³µìš© ì—ì…‹ê³¼ ì¶©ëŒ ìµœì†Œí™”) ===== */

    /* ë©”ì¸ ê·¸ë¦¬ë“œ: 2ì—´(ì¢Œ: í™•ë¥ /ì»¨íŠ¸ë¡¤, ìš°: íˆìŠ¤í† ê·¸ë¨/ì»¨íŠ¸ë¡¤) */
    main.grid.two-col { grid-template-columns: minmax(300px, 420px) 1fr; }
    @media (max-width: 980px){ main.grid.two-col { grid-template-columns: 1fr; } }

    /* ë°°ì§€/íŒíŠ¸/ì‘ì€ í…ìŠ¤íŠ¸ */
    .badge{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
            background: rgba(106,169,255,.15); color: var(--primary); font-weight:700; font-size:12px; }
    .legend, .small, .hint{ color: var(--muted); font-size: 12px; }

    /* ì¢Œì¸¡: í™•ë¥  ê·¸ë¦¬ë“œ & ë§‰ëŒ€ ì°¨íŠ¸ */
    .prob-grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .prob-item{ background: var(--panel); border:1px solid rgba(255,255,255,.06);
                border-radius:12px; padding:12px; cursor:pointer; box-shadow: var(--shadow); }
    @media (prefers-color-scheme: light){
      .prob-item{ border-color: rgba(2,6,23,.12); }
    }
    .prob-item h4{ margin:0 0 8px 0; font-size:14px; color: var(--muted); }
    .units{ display:grid; grid-template-columns: repeat(6, 1fr); gap:6px; margin-top:8px; }
    .unit{ height:14px; border-radius:999px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); }
    .unit.filled{ background: linear-gradient(180deg, var(--primary), rgba(106,169,255,.35)); border-color: rgba(106,169,255,.45); }

    /* ë²„íŠ¼ */
    .actions{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn{
      cursor:pointer; border:1px solid rgba(255,255,255,.06);
      background:#1a2446; color: var(--text);
      padding:10px 14px; border-radius:12px; font-weight:600; letter-spacing:.2px;
      transition: transform .15s ease, border-color .15s ease, filter .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(106,169,255,.45); }
    @media (prefers-color-scheme: light){
      .btn{ border-color: rgba(2,6,23,.12); }
    }
    .btn.primary{ background:#23407a; border-color:#2a4e9b; }
    .btn.warn{ background:#7a4a12; border-color:#9b5c17; }
    .checkbox{ display:flex; align-items:center; gap:8px; }

    /* ì°¨íŠ¸ ìº”ë²„ìŠ¤ */
    .chart-wrap{ padding:10px; background: var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:12px; box-shadow: var(--shadow); }
    #probChart{ width:100%; height:220px; display:block; }
    #sumChart { width:100%; height:360px; display:block; }

    /* í†µê³„ ë°•ìŠ¤ */
    .stats{ display:flex; gap:12px; flex-wrap:wrap; color:var(--muted); }
    .stat{ background: var(--panel); padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.06); }
  </style>
</head>
<body>
  <!-- â­ ë³„ ì• ë‹ˆë©”ì´ì…˜ ì œê±°: #starfield ìº”ë²„ìŠ¤ë¥¼ í¬í•¨í•˜ì§€ ì•ŠìŒ -->

  <!-- ê³µìš© í—¤ë” -->
  <header class="site-header">
    <h1>ì¤‘ì‹¬ê·¹í•œì •ë¦¬( CLT ) ì‹œë®¬ë ˆì´í„°</h1>
    <!-- ìš”ì²­ 2: ë¶€ì œ ì‚­ì œ -->
  </header>

  <main class="grid two-col">
    <!-- ì™¼ìª½: í™•ë¥  ì„¤ì • + ë©´ë³„ ë§‰ëŒ€ -->
    <section class="card" aria-label="ì£¼ì‚¬ìœ„ í™•ë¥  ì„¤ì •">
      <div class="badge">ğŸ² ì£¼ì‚¬ìœ„ í™•ë¥  ì„¤ì •</div>
      <!-- ìš”ì²­ 3: íŒíŠ¸ ë¬¸êµ¬ êµì²´ -->
      <p class="hint" style="margin-top:8px">ì¢Œí´ë¦­: ì¦ê°€ / ìš°í´ë¦­: ê°ì†Œ</p>

      <div class="actions" style="margin-top:10px">
        <button id="btnUniform" class="btn">ê· ë“± ë¶„í¬(2/12)</button>
        <button id="btnRandom" class="btn">ë¬´ì‘ìœ„ ë¶„í¬(ì •ìˆ˜ì¹¸)</button>
        <span class="checkbox">
          <input type="checkbox" id="chkResetOnChange" checked />
          <label for="chkResetOnChange" class="small">í™•ë¥  ë³€ê²½ ì‹œ ê²°ê³¼ ì´ˆê¸°í™”</label>
        </span>
      </div>

      <div class="prob-grid" id="probGrid" style="margin-top:12px"></div>

      <div class="chart-wrap" style="margin-top:12px">
        <canvas id="probChart" role="img" aria-label="ë©´ë³„ í™•ë¥  ë§‰ëŒ€ ì°¨íŠ¸"></canvas>
      </div>
    </section>

    <!-- ì˜¤ë¥¸ìª½: íˆìŠ¤í† ê·¸ë¨ + ì»¨íŠ¸ë¡¤/í†µê³„ -->
    <section class="card" aria-label="í•© íˆìŠ¤í† ê·¸ë¨ ë° ì‹¤í–‰ ì»¨íŠ¸ë¡¤">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
        <!-- ìš”ì²­ 4: ë°°ì§€ í…ìŠ¤íŠ¸ êµì²´ -->
        <div class="badge">íˆìŠ¤í† ê·¸ë¨(ë°€ë„)</div>
        <!-- ìš”ì²­ 5: ì•ˆë‚´ ë¬¸êµ¬ êµì²´ -->
        <div class="legend">ì™¼ìª½ì— ì„¤ì •ëœ ì£¼ì‚¬ìœ„ë¥¼ 12ë²ˆ êµ´ë ¤ì„œ ê° ëˆˆê¸ˆì˜ í•©ì„ íˆìŠ¤í† ê·¸ë¨ì— í‘œí˜„</div>
      </div>

      <div class="actions" style="margin-top:12px">
        <label for="speed" class="small">ì†ë„ (ì„¸ì…˜/ì´ˆ)</label>
        <input type="range" id="speed" min="1" max="2000" value="200" />
        <span id="speedLabel" class="small" style="min-width:3ch; text-align:right">200</span>
      </div>

      <div class="actions" style="margin-top:8px">
        <button class="btn primary" id="btnStartStop">â–¶ï¸ ì‹œì‘</button>
        <button class="btn" id="btnStep">í•œ ë²ˆ ì‹¤í–‰</button>
        <button class="btn warn" id="btnReset">ì´ˆê¸°í™”</button>
      </div>

      <div class="stats" style="margin-top:8px">
        <div class="stat">ì„¸ì…˜ ìˆ˜: <b id="statSessions">0</b></div>
        <!-- ìš”ì²­ 7: ë¼ë²¨ ë³€ê²½ -->
        <div class="stat">ëª¨í‰ê· : <b id="statPopMean">â€“</b></div>
        <div class="stat">í‘œë³¸í‰ê· (í•©): <b id="statMean">â€“</b></div>
        <!-- ìš”ì²­ 6: í‘œë³¸í‘œì¤€í¸ì°¨(í•©) ë°•ìŠ¤ ì‚­ì œ -->
      </div>

      <div class="chart-wrap" style="margin-top:12px">
        <canvas id="sumChart" role="img" aria-label="í•©ì˜ ë°€ë„ íˆìŠ¤í† ê·¸ë¨"></canvas>
      </div>

      <!-- ìš”ì²­ 8: íŒ ë¬¸êµ¬ êµì²´ -->
      <p class="small" style="margin-top:10px">
        ì¤‘ì‹¬ê·¹í•œì •ë¦¬ì— ì˜í•´ì„œ, ëª¨ì§‘ë‹¨ê³¼ ìƒê´€ì—†ì´ 12ê°œì˜ í•©ì€ ì¢…ëª¨ì–‘ì— ê°€ê¹Œì›Œì§„ë‹¤.
      </p>
    </section>
  </main>

  <!-- ë„¤ë¹„ê²Œì´ì…˜ í’‹í„° (ì˜ˆì‹œì™€ ë™ì¼ í¬ê¸°/íŒ¨ë”©) -->
  <footer class="site-footer">
    <a class="card" href="../" style="display:inline-block;padding:12px 18px;">â† ì´ì „ìœ¼ë¡œ</a>
    <a class="card" href="../../" style="display:inline-block;padding:12px 18px;">â† ì²˜ìŒìœ¼ë¡œ</a>
    <div style="margin-top:10px;"><small>Â© <span id="year"></span> aries0401-svc</small></div>
  </footer>

  <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸(í‚¤ë³´ë“œ ì¸í„°ë™ì…˜/ì—°ë„ í‘œê¸°) -->
  <script src="../../assets/site.js"></script>

  <script>
    // ===== ê³ í•´ìƒë„ ìº”ë²„ìŠ¤ ìŠ¤ì¼€ì¼ =====
    function fitCanvas(canvas) {
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      const w = Math.round(rect.width * dpr), h = Math.round(rect.height * dpr);
      if (canvas.width !== w || canvas.height !== h){ canvas.width = w; canvas.height = h; }
      return dpr;
    }

    // ===== ì „ì—­ ìƒíƒœ =====
    const FACES = 6;
    const TRIALS_PER_SESSION = 12; // ë™ì¼ ì£¼ì‚¬ìœ„ë¥¼ 12ë²ˆ êµ´ë¦¼
    const TOTAL_UNITS = 12;        // í™•ë¥  ë‹¨ìœ„ = 12ì¹¸ â†’ í™•ë¥ ì€ k/12

    const MIN_SUM = TRIALS_PER_SESSION * 1;
    const MAX_SUM = TRIALS_PER_SESSION * 6;
    const BINS = MAX_SUM - MIN_SUM + 1; // 61

    // í™•ë¥ ì€ 1/12 ë‹¨ìœ„ë¡œë§Œ ë³€í™” (ì´ˆê¸° ê° 2ì¹¸)
    let countsUnits = new Array(FACES).fill(TOTAL_UNITS / FACES);
    let probs = countsUnits.map(k => k/TOTAL_UNITS);
    let cdf = buildCDF(probs);

    let counts = new Array(BINS).fill(0); // í•© íˆìŠ¤í† ê·¸ë¨ ì¹´ìš´íŠ¸
    let sessions = 0;

    let running = false;
    let speed = 200; // sessions/sec (ì´ˆê¸°ê°’)
    let lastTs = 0;
    let carry = 0; // ëˆ„ì  ì†Œìˆ˜ ì„¸ì…˜

    // ===== DOM =====
    const probGrid = document.getElementById('probGrid');
    const probChart = document.getElementById('probChart');
    const sumChart = document.getElementById('sumChart');

    const btnUniform = document.getElementById('btnUniform');
    const btnRandom = document.getElementById('btnRandom');
    const chkResetOnChange = document.getElementById('chkResetOnChange');

    const speedInput = document.getElementById('speed');
    const speedLabel = document.getElementById('speedLabel');

    const btnStartStop = document.getElementById('btnStartStop');
    const btnStep = document.getElementById('btnStep');
    const btnReset = document.getElementById('btnReset');

    const statSessions = document.getElementById('statSessions');
    const statMean = document.getElementById('statMean');
    const statPopMean = document.getElementById('statPopMean');
    // ìš”ì²­ 6: statStd ì œê±°

    // ===== í™•ë¥  ì…ë ¥ UI (1/12 ë‹¨ìœ„) =====
    function updateFromCounts(){
      probs = countsUnits.map(k => k/TOTAL_UNITS);
      cdf = buildCDF(probs);
    }
    function faceHTML(i){
      const k = countsUnits[i];
      let units='';
      for (let u=0; u<TOTAL_UNITS; u++) units += '<div class="unit ' + (u<k? 'filled':'') + '"></div>';
      return '<h4>'+(i+1)+'ë²ˆ ë©´</h4>'
           + '<div class="units">'+units+'</div>'
           + '<div class="small">'+k+'/'+TOTAL_UNITS+'</div>';
    }
    function renderProbCells(){
      probGrid.innerHTML = '';
      for (let i=0;i<FACES;i++){
        const item = document.createElement('div');
        item.className = 'prob-item';
        item.innerHTML = faceHTML(i);
        item.addEventListener('click', (e)=>{ if(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey) adjustFace(i,-1); else adjustFace(i,+1); });
        item.addEventListener('contextmenu', (e)=>{ e.preventDefault(); adjustFace(i,-1); });
        probGrid.appendChild(item);
      }
      drawProb();
      updateStats();
    }
    function adjustFace(i, delta){
      if (delta>0){
        // +1: ë‹¤ë¥¸ ë©´(ìµœëŒ€ ë³´ìœ )ì—ì„œ 1ì¹¸ ê°€ì ¸ì™€ iì— ë”í•¨
        let donor=-1, max=-1;
        for (let j=0;j<FACES;j++) if (j!==i && countsUnits[j]>max){ max=countsUnits[j]; donor=j; }
        if (donor===-1 || countsUnits[donor]===0 || countsUnits[i]===TOTAL_UNITS) return;
        countsUnits[donor]--; countsUnits[i]++;
      } else if (delta<0){
        // -1: iì—ì„œ 1ì¹¸ ë¹¼ì„œ ë‹¤ë¥¸ ë©´(ìµœì†Œ ë³´ìœ )ì— ë”í•¨
        if (countsUnits[i]===0) return;
        let receiver=-1, min=Infinity;
        for (let j=0;j<FACES;j++) if (j!==i && countsUnits[j]<min){ min=countsUnits[j]; receiver=j; }
        if (receiver===-1 || countsUnits[receiver]===TOTAL_UNITS) return;
        countsUnits[i]--; countsUnits[receiver]++;
      } else { return; }
      updateFromCounts();
      if (chkResetOnChange && chkResetOnChange.checked) reset();
      renderProbCells();
    }

    // ===== ì´ë²¤íŠ¸ =====
    btnUniform.addEventListener('click', () => {
      setUniform();
      if (chkResetOnChange && chkResetOnChange.checked) reset();
      renderProbCells();
    });
    btnRandom.addEventListener('click', () => {
      setRandom();
      if (chkResetOnChange && chkResetOnChange.checked) reset();
      renderProbCells();
    });

    speedInput.addEventListener('input', () => {
      speed = parseInt(speedInput.value,10);
      speedLabel.textContent = String(speed);
    });

    btnStartStop.addEventListener('click', () => {
      running = !running;
      btnStartStop.textContent = running ? 'â¸ ì¼ì‹œì •ì§€' : 'â–¶ï¸ ì‹œì‘';
      if (running){ lastTs = performance.now(); requestAnimationFrame(loop); }
    });

    btnStep.addEventListener('click', () => { runSessions(1); });
    btnReset.addEventListener('click', () => { reset(); drawSum(); });

    window.addEventListener('resize', () => { drawProb(); drawSum(); });

    function setUniform(){
      countsUnits = new Array(FACES).fill(TOTAL_UNITS / FACES);
      updateFromCounts();
    }
    function setRandom(){
      countsUnits = new Array(FACES).fill(0);
      for (let t=0;t<TOTAL_UNITS;t++) countsUnits[Math.floor(Math.random()*FACES)]++;
      updateFromCounts();
    }

    function buildCDF(p){
      const c = []; let acc = 0;
      for (let i=0;i<p.length;i++){ acc += p[i]; c.push(acc); }
      c[c.length-1] = 1; // ìˆ˜ì¹˜ ì˜¤ì°¨ ë³´ì •
      return c;
    }

    // ===== ì‹œë®¬ë ˆì´ì…˜ ë£¨í”„ =====
    function loop(ts){
      if (!running) return;
      const dt = Math.max(0, ts - lastTs) / 1000; // sec
      lastTs = ts;
      const target = speed * dt + carry;
      const n = Math.floor(target);
      carry = target - n;
      if (n > 0) runSessions(n);
      requestAnimationFrame(loop);
    }

    function runSessions(n){
      for (let k=0;k<n;k++){
        let sum = 0;
        for (let t=0;t<TRIALS_PER_SESSION;t++) sum += sampleDie();
        counts[sum - MIN_SUM]++;
        sessions++;
      }
      updateStats();
      drawSum();
    }

    function sampleDie(){
      const u = Math.random();
      for (let i=0;i<FACES;i++) if (u <= cdf[i]) return i+1;
      return FACES; // fallback
    }

    // ===== í†µê³„ =====
    function updateStats(){
      statSessions.textContent = sessions.toLocaleString();

      // ì´ë¡ (ëª¨) í‰ê· : 12 * E[X]
      const e1 = probs.reduce((acc,p,i)=> acc + (i+1)*p, 0);
      const popMean = TRIALS_PER_SESSION * e1;
      statPopMean.textContent = popMean.toFixed(3);

      if (sessions === 0){
        statMean.textContent = 'â€“';
        return;
      }
      let mean = 0;
      for (let i=0;i<BINS;i++){
        const value = i + MIN_SUM;
        const freq = counts[i];
        mean += value * freq;
      }
      mean /= sessions;
      statMean.textContent = mean.toFixed(3);
      // ìš”ì²­ 6: í‘œë³¸í‘œì¤€í¸ì°¨ ê³„ì‚°/í‘œì‹œëŠ” ì œê±°
    }

    function reset(){
      counts.fill(0); sessions = 0; carry = 0; updateStats();
    }

    // ===== ê·¸ë¦¬ê¸°: ë©´ í™•ë¥  ë°” ì°¨íŠ¸ =====
    function drawProb(){
      const dpr = fitCanvas(probChart);
      const ctx = probChart.getContext('2d');
      const W = probChart.width, H = probChart.height;
      ctx.clearRect(0,0,W,H);

      const margin = {l: 48, r: 20, t: 18, b: 40};
      const w = W - margin.l - margin.r;
      const h = H - margin.t - margin.b;

      // ì¶•/ê·¸ë¦¬ë“œ
      ctx.strokeStyle = 'rgba(148,163,184,0.2)'; // var(--muted) ê·¼ì‚¬
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(margin.l, margin.t); ctx.lineTo(margin.l, margin.t + h); ctx.lineTo(margin.l + w, margin.t + h); ctx.stroke();

      // y ëˆˆê¸ˆ
      const maxP = Math.max(0.25, Math.max(...probs) * 1.1);
      const ticks = 5;
      ctx.fillStyle = 'rgba(148,163,184,.9)';
      ctx.textAlign = 'right'; ctx.textBaseline = 'middle'; ctx.font = (12*dpr)+'px "Noto Sans KR", system-ui';
      for (let i=0;i<=ticks;i++){
        const y = margin.t + h - (h * i / ticks);
        const v = (maxP * i / ticks);
        ctx.globalAlpha = 0.35; ctx.beginPath(); ctx.moveTo(margin.l, y); ctx.lineTo(margin.l + w, y); ctx.stroke();
        ctx.globalAlpha = 1; ctx.fillText(v.toFixed(2), margin.l - 6, y);
      }

      // ë§‰ëŒ€
      const barGap = 12 * dpr;
      const barW = (w - barGap*(FACES-1)) / FACES;
      for (let i=0;i<FACES;i++){
        const x = margin.l + i*(barW + barGap);
        const y = margin.t + h;
        const bh = h * (probs[i] / maxP);
        const grad = ctx.createLinearGradient(0, y-bh, 0, y);
        grad.addColorStop(0, 'rgba(106,169,255,0.95)');   // var(--primary) ê·¼ì‚¬
        grad.addColorStop(1, 'rgba(106,169,255,0.25)');
        ctx.fillStyle = grad;
        roundRect(ctx, x, y-bh, barW, bh, 6*dpr); ctx.fill();

        // ë¼ë²¨
        ctx.fillStyle = 'rgba(232,236,241,.95)'; // var(--text) ê·¼ì‚¬
        ctx.textAlign = 'center'; ctx.textBaseline = 'alphabetic'; ctx.font = (12*dpr)+'px "Noto Sans KR", system-ui';
        ctx.fillText(String(i+1), x + barW/2, margin.t + h + 18*dpr);

        ctx.textBaseline = 'bottom'; ctx.font = (11*dpr)+'px "Noto Sans KR", system-ui';
        ctx.fillText((probs[i]).toFixed(3), x + barW/2, y - bh - 4*dpr);
      }
    }

    // ===== ê·¸ë¦¬ê¸°: í•© íˆìŠ¤í† ê·¸ë¨ (ë°€ë„) =====
    function drawSum(){
      const dpr = fitCanvas(sumChart);
      const ctx = sumChart.getContext('2d');
      const W = sumChart.width, H = sumChart.height;
      ctx.clearRect(0,0,W,H);

      const margin = {l: 54, r: 20, t: 18, b: 46};
      const w = W - margin.l - margin.r;
      const h = H - margin.t - margin.b;

      // ë°°ê²½ í”„ë ˆì„/ê·¸ë¦¬ë“œ
      ctx.strokeStyle = 'rgba(148,163,184,0.2)';
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(margin.l, margin.t); ctx.lineTo(margin.l, margin.t + h); ctx.lineTo(margin.l + w, margin.t + h); ctx.stroke();

      // y-ìŠ¤ì¼€ì¼: ë°€ë„ [0, max]
      let maxDensity = 0;
      if (sessions > 0){
        for (let i=0;i<BINS;i++) maxDensity = Math.max(maxDensity, counts[i] / sessions);
        maxDensity *= 1.1; // ì—¬ë°±
      } else {
        maxDensity = 0.1;
      }

      const yTicks = 5;
      ctx.fillStyle = 'rgba(148,163,184,.9)';
      ctx.textAlign = 'right'; ctx.textBaseline = 'middle'; ctx.font = (12*dpr)+'px "Noto Sans KR", system-ui';
      for (let i=0;i<=yTicks;i++){
        const y = margin.t + h - (h * i / yTicks);
        const v = (maxDensity * i / yTicks);
        ctx.globalAlpha = 0.35; ctx.beginPath(); ctx.moveTo(margin.l, y); ctx.lineTo(margin.l + w, y); ctx.stroke();
        ctx.globalAlpha = 1; ctx.fillText(v.toFixed(3), margin.l - 6, y);
      }

      // x-ì¶• ëˆˆê¸ˆ
      const xTicks = 10;
      ctx.textAlign = 'center'; ctx.textBaseline = 'alphabetic'; ctx.font = (12*dpr)+'px "Noto Sans KR", system-ui';
      for (let i=0;i<=xTicks;i++){
        const value = MIN_SUM + Math.round((MAX_SUM - MIN_SUM) * i / xTicks);
        const x = margin.l + (w * (value - MIN_SUM) / (MAX_SUM - MIN_SUM));
        ctx.globalAlpha = 0.45; ctx.beginPath(); ctx.moveTo(x, margin.t); ctx.lineTo(x, margin.t + h); ctx.stroke(); ctx.globalAlpha = 1;
        ctx.fillText(String(value), x, margin.t + h + 22*dpr);
      }

      // ë§‰ëŒ€ (ë…¹ìƒ‰ ê³„ì—´)
      const binW = w / BINS;
      for (let i=0;i<BINS;i++){
        const density = sessions === 0 ? 0 : counts[i] / sessions; // í•©ì´ 1ì¸ ë°€ë„
        const bh = h * (density / maxDensity);
        const x = margin.l + i * binW + 0.5*dpr;
        const y = margin.t + h - bh;
        const inset = Math.max(0.15*binW, 1*dpr);
        const width = Math.max(binW - inset, 1.5*dpr);
        const grad = ctx.createLinearGradient(0,y,0,y+bh);
        grad.addColorStop(0, 'rgba(34,197,94,0.95)'); // #22c55e
        grad.addColorStop(1, 'rgba(34,197,94,0.20)');
        ctx.fillStyle = grad;
        roundRect(ctx, x, y, width, bh, 4*dpr); ctx.fill();
      }

      // xì¶• ë¼ë²¨
      ctx.fillStyle = 'rgba(148,163,184,.85)';
      ctx.textAlign = 'center'; ctx.textBaseline = 'alphabetic'; ctx.font = (12*dpr)+'px "Noto Sans KR", system-ui';
      ctx.fillText('í•©', margin.l + w/2, margin.t + h + 36*dpr);
    }

    function roundRect(ctx, x, y, w, h, r){
      r = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }

    // ===== ì´ˆê¸° ë Œë” =====
    speedLabel.textContent = String(speed);
    renderProbCells();
    drawSum();
  </script>
</body>
</html>
